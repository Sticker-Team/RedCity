<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Red City</title>
		<link rel="stylesheet" type="text/css" href="Styles/style.css">
		<script type="text/javascript" src="cordova.js"></script>
	</head>

	<body>
		<div id = "gamearea">
			<canvas id = "mcanvas" style = "z-index: 1">
				Your browser does not support the HTML5 'Canvas' tag.
			</canvas>

		</div>
	</body>
</html>

<script src = "./Objects/objects.js"></script>
<script>
/**
*	Canvas and context
**/

// Foreground Canvas
var maincanvas;
var mctx;

/**
*	Game State Variables
**/
	
var sprites;
var go;
var windowWidth;
var windowHeight;
	
/**
*	Intervals
**/

var renderCanvasInterval = null;
	
/**
*	Images
**/

var building_1 = new Image();


/**
*	Sound
**/

// Start
window.onload = onAllAssetsLoaded;

// On load
function onAllAssetsLoaded(){
	//document.addEventListener("deviceready", onDeviceReady, false);
	onDeviceReady(); // This is for web testing
}

function onDeviceReady(){
    maincanvas = document.getElementById("mcanvas");
    mctx = maincanvas.getContext("2d");
	
	/*
	maincanvas.addEventListener("touchstart", handleTouchstartEvent, false);
	maincanvas.addEventListener("touchend", handleTouchendEvent, false);
    maincanvas.addEventListener("touchmove", handleTouchmoveEvent, false);
		*/
		
	gameSetup();
}

function gameSetup(){
	initialise();
	resizeWindow();
	generateWorld();
	roundSetup();
	
}

function generateWorld(){
	go = new GameObject(building_1, 0, 0, 100, 100);
	sprites.push(go);
}

function resizeWindow(){
	var gameArea = document.getElementById('gamearea');
	var widthToHeight = 2 / 1;
	var newWidth = window.innerWidth;
	var newHeight = window.innerHeight;
	var newWidthToHeight = newWidth / newHeight;
	
	if (newWidthToHeight > widthToHeight) {
		// window width is too wide relative to desired game width
		newWidth = newHeight * widthToHeight;
		gameArea.style.height = newHeight + 'px';
		gameArea.style.width = newWidth + 'px';
	} 
	else { 
		//window height is too high relative to desired game height
		newHeight = newWidth / widthToHeight;
		gameArea.style.width = newWidth + 'px';
		gameArea.style.height = newHeight + 'px';
	}
	gameArea.style.marginTop = (-newHeight / 2) + 'px';
	gameArea.style.marginLeft = (-newWidth / 2) + 'px';
	
    maincanvas.width = newWidth;
    maincanvas.height = newHeight;
	
	//Background.prototype.canvasWidth = newWidth;
	//Background.prototype.canvasHeight = newHeight;
	
	//Foreground.prototype.canvasWidth = newWidth;
	//Foreground.prototype.canvasHeight = newHeight;
}

function initialise(){
	sprites = [];
	building_1.src = "./Images/Sprites/building_new_1.png";
}

function roundSetup(){
	renderCanvasInterval = setInterval(update, 10);  			// game loop
}

function renderBackground(){
	mctx.clearRect(0, 0, maincanvas.width, maincanvas.height);
	
	for(i = 0; i < sprites.length; i++){
		sprites[i].draw();
	}
}

function update(){
	renderBackground();
}




</script>